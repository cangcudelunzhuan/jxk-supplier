'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = Orderly;

var _common = require('./common');

var _common2 = _interopRequireDefault(_common);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function Orderly(func) {
  var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};

  var selfThis = this;
  var touchLoading = false;

  return function () {
    var args = Array.from(arguments);
    args.push(function () {
      touchLoading = false;
    });

    if (!touchLoading) {
      touchLoading = true;
      var ret = func.apply(selfThis, args);

      _common2.default.seek().equal(ret && typeof ret.then === 'function', function () {
        return ret.then(function () {
          touchLoading = false;
        });
      }).equal(ret && typeof ret.finally === 'function', function () {
        return ret.finally(function () {
          touchLoading = false;
        });
      }).equal(ret && typeof ret.catch === 'function', function () {
        return ret.catch(function () {
          touchLoading = false;
        });
      }).else(function () {
        return options.orderlyTimer === null ? null : setTimeout(function () {
          touchLoading = false;
        }, options.orderlyTimer || 1200);
      }).get()();
    }
  };
}
module.exports = exports['default'];